@using Microsoft.Extensions.Configuration
@using Microsoft.AspNetCore.Hosting
@using Microsoft.Bot.Streaming.Payloads
@using Microsoft.Extensions.Hosting
@using SnackApp.Models
@inject TeamsFx teamsfx
@inject TeamsUserCredential teamsUserCredential
@inject IWebHostEnvironment HostEnvironment
@inject IConfiguration Configuration
@inject NavigationManager MyNavigationManager
@rendermode InteractiveServer

<Loading>
    <div class="welcome page">
        <div class="narrow page-padding">
            <img src="hello.png" />
            <h1 class="center">Welkom bij de Innvolve SnackApp @(!String.IsNullOrEmpty(userName) ? ", " + userName : "")!</h1>
            <p class="center">Your app is running in your @(GetEnvironmentName())</p>
            <FluentTabs style="width: 80%; justify-content: space-between; margin: 4rem auto;">
                <FluentTab style="font-size: 14px; min-height: 32px;">
                    @if (GroupOrder is null)
                    {
                        <Header>Groepsbestelling beginnen</Header>
                        <Content>
                            <CreateGroupOrder @Group/>
                        </Content>
                    }
                    @if (GroupOrder is not null)
                    {
                        <header>Deelnemen aan bestaande groepsbestelling</header>
                        <Content>
                            <JoinGroupOrder />
                        </Content>
                    }
                </FluentTab>
                <FluentTab>
                    <Header>Groepsbestelling</Header>
                    <Content>
                        <Deploy />
                    </Content>
                </FluentTab>
                <FluentTab>
                    <Header>3. Publish to Teams</Header>
                    <Content>
                        <Publish />
                    </Content>
                </FluentTab>
                <FluentTab>
                    <Header>4. Meedoen met groepsbestelling</Header>
                    <Content>
                        <JoinGroupOrder />
                    </Content>
                </FluentTab> 
                <FluentTab>
                    <Header>5. Artikelen zoeken</Header>
                    <Content>
                        <Search />
                    </Content>
                </FluentTab>            
            </FluentTabs>
            

        </div>
    </div>
</Loading>

@code {
    GroupOrderVM GroupOrder;
    string userName;
    string errorMessage;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            var user = await teamsUserCredential.GetUserInfoAsync();
            userName = user.DisplayName;
        }
        StateHasChanged();
    }

    private string GetEnvironmentName()
    {
        return HostEnvironment.IsDevelopment() ? "local environment" : "Azure environment";
    }
}